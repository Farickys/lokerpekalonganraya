generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(COMPANY)
  createdAt DateTime @default(now())
  company   Company?
}

enum Role {
  ADMIN
  COMPANY
  JOBSEEKER
}

model Company {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique
  user        User     @relation(fields: [userId], references: [id])
  name        String
  logo        String?
  description String?  @db.Text
  website     String?
  address     String?
  city        String?
  verified    Boolean  @default(false)
  createdAt   DateTime @default(now())
  jobs        Job[]
}

model Job {
  id            Int        @id @default(autoincrement())
  companyId     Int?
  company       Company?   @relation(fields: [companyId], references: [id])
  title         String
  slug          String     @unique
  description   String     @db.LongText
  requirements  String?    @db.Text
  salary        String?
  salaryMin     Int?
  salaryMax     Int?
  jobType       JobType    @default(FULLTIME)
  education     String?
  experience    String?
  city          String
  area          Area
  address       String?
  contactWa     String?
  contactEmail  String?
  applyUrl      String?
  category      String
  tags          String?
  featured      Boolean    @default(false)
  status        JobStatus  @default(PENDING)
  source        JobSource  @default(MANUAL)
  sourceUrl     String?
  sourceImage   String?
  views         Int        @default(0)
  applyCount    Int        @default(0)
  expiredAt     DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

enum JobType {
  FULLTIME
  PARTTIME
  FREELANCE
  INTERNSHIP
  CONTRACT
}

enum Area {
  KOTA_PEKALONGAN
  KAB_PEKALONGAN
  BATANG
  PEMALANG
}

enum JobStatus {
  PENDING
  ACTIVE
  CLOSED
  REJECTED
}

enum JobSource {
  MANUAL
  COMPANY
  SCRAPED_IG
  SCRAPED_FB
}

model WebhookLog {
  id        Int      @id @default(autoincrement())
  source    String
  payload   String   @db.LongText
  status    String
  message   String?
  createdAt DateTime @default(now())
}

model SavedJob {
  id        Int      @id @default(autoincrement())
  userId    Int
  jobId     Int
  createdAt DateTime @default(now())

  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
}

model JobSeekerProfile {
  id         Int      @id @default(autoincrement())
  userId     Int      @unique
  phone      String?
  location   String?
  bio        String?  @db.Text
  skills     String?  @db.Text
  experience String?
  education  String?
  cvUrl      String?
  cvName     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
}

model Application {
  id          Int               @id @default(autoincrement())
  userId      Int
  jobId       Int
  coverLetter String?           @db.Text
  status      ApplicationStatus @default(SUBMITTED)
  notes       String?           @db.Text
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
  @@index([status])
}

enum ApplicationStatus {
  SUBMITTED
  REVIEWED
  ACCEPTED
  REJECTED
}

model JobAlert {
  id         Int            @id @default(autoincrement())
  userId     Int
  keyword    String?
  area       String?
  category   String?
  jobType    String?
  frequency  AlertFrequency @default(DAILY)
  active     Boolean        @default(true)
  lastSentAt DateTime?
  createdAt  DateTime       @default(now())

  @@index([userId])
  @@index([active])
}

enum AlertFrequency {
  DAILY
  WEEKLY
}
